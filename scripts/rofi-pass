#!/bin/bash

LAUNCHER='rofi -dmenu -lines 5 -i -p  -no-history'

option=$(\
  pass git ls-files \
  | grep '.gpg$' \
  | sed -e 's/.gpg$//' \
  | $LAUNCHER \
)

if [ ${#option} -gt 0 ]; then
  notify-send \
    "Decrypting …" \
    "Pass is trying to decrypt <b>${option}</b>"

  case "$1" in
    "login")
      pass show "$option" -c2
      ;;
    "password")
      pass show "$option" -c1
      ;;
    "")
      pass show "$option" -c1
      ;;
  esac

  if [ $? = 0 ]; then
    notify-send \
      "Copied!" \
      "The clipboard will be cleared in <b>45 sec</b>"
  else
    notify-send \
      "Error" \
      "Something went wrong while trying to decrypt your password.\nTry running pass manually to see what's wrong"
  fi
fi
