#!/bin/sh

LAUNCHER='rofi -dmenu -p "" -theme-str "#content { children: [inputbar]; }"'
LAUNCHER2='rofi -dmenu -lines 7 -i -p '
OPTIONS="Inbox\nWork\nHome\nConnect\nContinuous Improvement\nCourses\nRoll20"

input=$(eval $LAUNCHER)

if [[ -n "$input" ]]; then
  option=`echo -e $OPTIONS | $LAUNCHER2`
  if [ ${#option} -gt 0 ]; then
    case $option in
      Inbox)
        args="'$input' +inbox"
        ;;
      Work)
        args="'$input' +inbox +@work"
        ;;
      Home)
        args="'$input' +inbox +@home"
        ;;
      Connect)
        args="'$input' +inbox +@work project:connect"
        ;;
      "Continuous Improvement")
        args="'$input' project:improvements"
        ;;
      Courses)
        args="'$input' project:shopping"
        ;;
      Roll20)
        args="'$input' project:roll20 +@home"
        ;;
      *)
        args=''
        ;;
    esac

    if [ -n "$args" ]; then
      uuid=$(task add $args | perl -pe 's|Created task (.*)\.|\1|')
      url=$(echo $input | perl -pe 's|^.*(https?://.*?)(( .*)?)$|\1|')
      if [ -n $url ]; then
        task annotate $uuid $url
      fi
    fi
  fi
fi
