#!/bin/sh

LAUNCHER='rofi -dmenu -p "" -theme-str "#content { children: [inputbar]; }"'
LAUNCHER2='rofi -dmenu -lines 9 -i -p '
OPTIONS="Inbox\nHome\nWork\nConnect\nCSE\nManagement\nContinuous Improvement\nCourses\nSomeday"

input=$(eval $LAUNCHER)

if [[ -n "$input" ]]; then
  option=`echo -e $OPTIONS | $LAUNCHER2`
  if [ ${#option} -gt 0 ]; then
    case $option in
      Inbox)
        args="+inbox"
        ;;
      Work)
        args="+inbox +@work"
        ;;
      Home)
        args="+inbox +@home"
        ;;
      Management)
        args="+inbox +@work project:mgt"
        ;;
      Connect)
        args="+inbox +@work project:connect"
        ;;
      "Continuous Improvement")
        args="project:improvements"
        ;;
      Courses)
        args="project:shopping"
        ;;
      CSE)
        args="+inbox project:CSE +@work"
        ;;
      Someday)
        args="+someday"
        ;;
      *)
        args=''
        ;;
    esac

    if [ -n "$args" ]; then
      uuid=$(task add "$input" $args | perl -pe 's|Created task (.*)\.|\1|')
      url=$(echo $input | egrep -o 'https?://[^ ]+')
      if [ -n $url ]; then
        task annotate $uuid $url
      fi
    fi
  fi
fi
